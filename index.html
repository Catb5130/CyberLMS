<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saranga Thenuwara - IT Services & Support</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css">
    <!-- Favicon -->
    <link rel="icon" href="logo.jpg" type="image/x-icon">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <img src="logo.jpg" alt="Saranga Thenuwara IT Services Logo">
        </div>
        <nav>
            <ul class="nav-links">
                <li><a href="#services">Services</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>Expert IT Services & Support for Your Business</h1>
        <p>Transforming Technology Challenges into Seamless Solutions</p>
        <a href="#contact" class="cta-button">Get in Touch</a>
    </section>

    <!-- Services Section -->
    <section id="services" class="services">
        <h2>Our Services</h2>
        <div class="service-grid">
            <div class="service-item">
                <h3>System Administration</h3>
                <p>Windows Server management, Active Directory, backup solutions, and more.</p>
            </div>
            <div class="service-item">
                <h3>Networking</h3>
                <p>Routing, switching, VPN setup, wireless solutions, and more.</p>
            </div>
            <div class="service-item">
                <h3>Cloud Solutions</h3>
                <p>Azure, AWS services, cloud migration, and management.</p>
            </div>
            <div class="service-item">
                <h3>Cybersecurity</h3>
                <p>Security policies, firewall management, penetration testing, and more.</p>
            </div>
            <div class="service-item">
                <h3>SSL Support</h3>
                <p>Secure your website and applications with SSL certificate installation and management.</p>
            </div>
            <div class="service-item">
                <h3>Remote Support</h3>
                <p>24/7 remote IT support for troubleshooting, maintenance, and system optimization.</p>
            </div>
            <div class="service-item">
                <h3>O365 Support</h3>
                <p>Comprehensive support for Microsoft 365, including email, Teams, and productivity tools.</p>
            </div>
            <div class="service-item">
                <h3>SharePoint Support</h3>
                <p>Custom SharePoint development, configuration, and ongoing support for collaboration.</p>
            </div>
            <div class="service-item">
                <h3>PowerShell Automation</h3>
                <p>Streamline tasks and automate workflows using PowerShell scripting for Windows environments.</p>
            </div>
            <div class="service-item">
                <h3>Python Automation</h3>
                <p>Develop custom scripts and automate processes using Python for cross-platform solutions.</p>
            </div>
        </div>
    </section>

    <!-- About Us -->
    <section id="about" class="about">
        <h2>About Us</h2>
        <p>Saranga Thenuwara IT Services provides top-notch IT solutions with over 7 years of experience. Our mission is to deliver reliable and efficient IT services tailored to meet the unique needs of our clients.</p>
    </section>

    <!-- Contact Us -->
    <section id="contact" class="contact">
        <h2>Contact Us</h2>
        <p>Email: info@sarangait.com</p>
        <p>Phone: +94 77 123 4567</p>
        <p>Location: Colombo, Sri Lanka</p>
    </section>

    <!-- Chatbot Widget -->
    <div class="chatbot-widget" onclick="openChat()">ðŸ’¬ Chat with us</div>

    <!-- Chat Window -->
    <div id="chat-window" class="chat-window">
        <div class="chat-header">
            <h3>Live Chat</h3>
            <button class="close-btn" onclick="closeChat()">Ã—</button>
        </div>
        <div class="chat-body" id="chat-body">
            <!-- Messages will be dynamically added here -->
        </div>
        <div class="chat-footer">
            <input type="text" id="user-input" placeholder="Type your message..." onkeypress="handleKeyPress(event)" />
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <!-- JavaScript -->
   <!-- Chatbot Widget -->
    <div class="chatbot-widget" onclick="openChat()">ðŸ’¬ Chat with us</div>

    <!-- Chat Window -->
    <div id="chat-window" class="chat-window">
        <div class="chat-header">
            <h3>Live Chat</h3>
            <button class="close-btn" onclick="closeChat()">Ã—</button>
        </div>
        <div class="chat-body" id="chat-body">
            <!-- Messages will be dynamically added here -->
        </div>
        <div class="chat-footer">
            <input type="text" id="user-input" placeholder="Type your message..." onkeypress="handleKeyPress(event)" />
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Conversation state management
        const conversationState = {
            userId: Date.now(), // Unique ID for each user session
            state: 'start', // Current state of the conversation
            userData: {
                name: '',
                email: '',
                phone: '',
                issue: ''
            }
        };

        // Open the chat window
        function openChat() {
            document.getElementById('chat-window').style.display = 'block';
            if (conversationState.state === 'start') {
                addBotMessage("Hi! Welcome to Saranga Thenuwara IT Support. How can I assist you today?");
                conversationState.state = 'awaiting_response';
            }
        }

        // Close the chat window
        function closeChat() {
            document.getElementById('chat-window').style.display = 'none';
        }

        // Add a bot message to the chat body
        function addBotMessage(message) {
            const chatBody = document.getElementById('chat-body');
            const messageElement = document.createElement('div');
            messageElement.classList.add('bot-message');
            messageElement.textContent = message;
            chatBody.appendChild(messageElement);
            chatBody.scrollTop = chatBody.scrollHeight; // Auto-scroll to the bottom
        }

        // Add a user message to the chat body
        function addUserMessage(message) {
            const chatBody = document.getElementById('chat-body');
            const messageElement = document.createElement('div');
            messageElement.classList.add('user-message');
            messageElement.textContent = message;
            chatBody.appendChild(messageElement);
            chatBody.scrollTop = chatBody.scrollHeight; // Auto-scroll to the bottom
        }

        // Handle user input
        function sendMessage() {
            const userInput = document.getElementById('user-input').value.trim();
            if (!userInput) return;

            // Add user message to chat
            addUserMessage(userInput);

            // Process the user input based on the current state
            processUserInput(userInput);

            // Clear the input field
            document.getElementById('user-input').value = '';
        }

        // Handle Enter key press
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Process user input based on the current state
        function processUserInput(input) {
            switch (conversationState.state) {
                case 'start':
                    // Greet the user and start the conversation
                    addBotMessage("Hi! Welcome to Saranga Thenuwara IT Support. How can I assist you today?");
                    conversationState.state = 'awaiting_response';
                    break;

                case 'awaiting_response':
                    // Check if the user says "Hi" or similar
                    if (['hi', 'hello', 'hey'].includes(input.toLowerCase())) {
                        addBotMessage("Hello! How can I assist you today?");
                    } else {
                        addBotMessage("Sure, let's get started. Could you please provide your name?");
                        conversationState.state = 'awaiting_name';
                    }
                    break;

                case 'awaiting_name':
                    // Save the user's name
                    if (input.trim()) {
                        conversationState.userData.name = input;
                        addBotMessage(`Nice to meet you, ${input}! Could you please share your email address?`);
                        conversationState.state = 'awaiting_email';
                    } else {
                        addBotMessage("Your name is required. Please provide it.");
                    }
                    break;

                case 'awaiting_email':
                    // Validate and save the user's email
                    if (validateEmail(input)) {
                        conversationState.userData.email = input;
                        addBotMessage("Thank you! Could you also provide your mobile number with the country code (e.g., +94)?");
                        conversationState.state = 'awaiting_phone';
                    } else {
                        addBotMessage("That doesn't look like a valid email. Please try again.");
                    }
                    break;

                case 'awaiting_phone':
                    // Validate and save the user's phone number
                    if (validatePhone(input)) {
                        conversationState.userData.phone = input;
                        addBotMessage("Got it! Finally, could you describe the issue or request you have?");
                        conversationState.state = 'awaiting_issue';
                    } else {
                        addBotMessage("Please provide a valid mobile number with the country code (e.g., +94).");
                    }
                    break;

                case 'awaiting_issue':
                    // Save the user's issue/request
                    if (input.trim()) {
                        conversationState.userData.issue = input;
                        addBotMessage("Thank you for sharing your details. Let me forward this to our support team.");

                        // Send the collected data to the backend
                        sendUserDataToBackend(conversationState.userData);

                        // Reset the conversation state
                        conversationState.state = 'start';
                        conversationState.userData = { name: '', email: '', phone: '', issue: '' };
                    } else {
                        addBotMessage("Your issue or request is required. Please describe it.");
                    }
                    break;

                default:
                    addBotMessage("I'm sorry, I didn't understand that. Could you clarify?");
                    break;
            }
        }

        // Validate email format
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Validate phone number with country code (E.164 format)
        function validatePhone(phone) {
            const phoneRegex = /^\+[1-9]\d{1,14}$/; // E.164 format (e.g., +94771234567)
            return phoneRegex.test(phone);
        }

        // Send user data to the backend
        async function sendUserDataToBackend(userData) {
            try {
                const response = await fetch('/send-message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData),
                });

                const result = await response.json();

                if (result.success) {
                    addBotMessage("Your message has been sent successfully!");
                } else {
                    addBotMessage("There was an issue sending your message. Please try again later.");
                }
            } catch (error) {
                console.error(error);
                addBotMessage("An error occurred while sending your message. Please try again later.");
            }
        }
    </script>

</body>
</html>
